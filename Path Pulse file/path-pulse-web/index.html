<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Path-Pulse â€” Tactical Bio-Lab</title>
  <link rel="icon" type="image/png" href="icon-512.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="icon-512.png" sizes="192x192" />
  <link rel="apple-touch-icon" href="icon-512.png" />
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="styles.css?v=2">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
  <div id="app">
    <!-- Loader -->
    <div id="loader">
      <div class="spinner"></div>
      <p>INITIALIZING LAB...</p>
    </div>

    <!-- Oath (shown before first accept) -->
    <div id="oath-screen" class="screen hidden">
      <h1>EXPLORER'S OATH</h1>
      <p class="subtitle">SYSTEM INITIALIZATION: SUBJECT VERIFICATION</p>
      <div class="oath-text">
        <p>I acknowledge that my body is the ultimate hardware. I recognize that movement is not a chore, but a mission to synchronize my physical output with the Global Grid.</p>
        <ul>
          <li><strong>DATA INTEGRITY:</strong> I will trust the Lab. I understand that the data provided is objective.</li>
          <li><strong>TERRAIN MANDATE:</strong> I will not fear the incline or the sand. DifficultyÃ—Resistance=Evolution.</li>
          <li><strong>GHOST PROTOCOL:</strong> I accept the challenge of my Past Self via the AR Ghost-Path.</li>
          <li><strong>FUELING DISCIPLINE:</strong> I agree to view food as Protocol and honor Predictive Fueling.</li>
          <li><strong>GRID TRANSPARENCY:</strong> I may share Tactical Time-Lapses to inspire new Explorers.</li>
        </ul>
      </div>
      <button id="accept-oath" class="btn-primary" aria-label="Accept Explorer's Oath and start the app">ACCEPT OATH & INITIALIZE GRID</button>
      <button id="abort-oath" class="btn-text" aria-label="Abort and close oath screen">ABORT MISSION</button>
    </div>

    <!-- Main shell: Map | Home | Profile -->
    <div id="main-shell" class="screen hidden">
      <div id="install-banner" class="install-banner hidden" role="region" aria-label="Install app">
        <span class="install-banner-text">Add Path-Pulse to Home Screen for quick access</span>
        <button type="button" id="install-banner-dismiss" class="install-banner-dismiss" aria-label="Dismiss">Ã—</button>
      </div>
      <main id="tab-content" role="main">
        <!-- Map tab -->
        <div id="tab-map" class="tab-pane">
          <div id="map"></div>
          <div id="map-distance-hud" class="map-distance-hud">
            <div class="hud-row"><span id="map-distance-label">â€”</span><span id="map-distance-km">0.00</span> km</div>
            <div class="hud-row"><span>Perimeter</span><span id="map-perimeter-km">0.00</span> km</div>
            <div class="hud-row"><span>Milometer</span><span id="map-milometer-km">0.00</span> km</div>
          </div>
          <div class="map-controls">
            <button id="btn-location" class="fab small" title="My location" aria-label="Center map on my location">âŒ–</button>
            <div id="replay-controls" class="replay-controls hidden">
              <span class="replay-label">Replay:</span>
              <button type="button" class="replay-dur" data-duration="5" aria-label="5 second replay">5s</button>
              <button type="button" class="replay-dur active" data-duration="8" aria-label="8 second replay">8s</button>
              <button type="button" class="replay-dur" data-duration="15" aria-label="15 second replay">15s</button>
              <label class="replay-loop"><input type="checkbox" id="replay-loop" aria-label="Loop replay"> Loop</label>
            </div>
            <button id="btn-replay-route" class="fab small hidden" title="Replay route" aria-label="Replay route time-lapse">âŸ³</button>
            <button id="btn-expedition" class="fab extended" aria-label="Start or stop expedition">
              <span id="expedition-icon">â–¶</span>
              <span id="expedition-label">START EXPEDITION</span>
            </button>
          </div>
        </div>
        <!-- Home tab -->
        <div id="tab-home" class="tab-pane">
          <div class="top-bar">
            <div>
              <p class="id">EXPLORER ID: <span id="explorer-id">PATHFINDER_01</span></p>
              <p class="level">LEVEL <span id="level">1</span> Â· <span id="rank">RECRUIT</span></p>
            </div>
            <div class="avatar">ðŸ‘¤</div>
          </div>
          <div class="kinetic-ring">
            <div class="ring-bg"></div>
            <div class="ring-fill" id="ring-fill"></div>
            <div class="ring-content">
              <span id="steps">0</span>
              <span class="label">KINETIC STEPS</span>
            </div>
          </div>
          <button id="btn-mission-home" class="mission-btn">
            <span id="mission-icon">â–¶</span>
            <span id="mission-label">START EXPEDITION</span>
          </button>
          <div id="last-route" class="last-route hidden">Last route: <span id="last-route-km">0</span> km</div>
          <div id="expedition-mission" class="expedition-mission">
            <p class="mission-title">MISSION: Walk <span id="mission-target-km">2</span> km this week</p>
            <div class="mission-progress-bg"><div class="mission-progress-fill" id="mission-progress-fill"></div></div>
            <p id="mission-status" class="mission-status">0 / 2 km</p>
          </div>
          <div class="fuel-section">
            <h3>FUEL GAUGE</h3>
            <div class="diag-row"><span>BMR (basal)</span><span id="fuel-bmr">â€”</span></div>
            <div class="diag-row"><span>Est. daily need (TDEE)</span><span id="fuel-tdee">â€”</span></div>
            <div class="diag-row"><span>Active burn today</span><span id="fuel-burn">â€”</span></div>
            <div class="fuel-intake">
              <label>Calories in today</label>
              <input type="number" id="input-calories" placeholder="e.g. 1800" min="0" step="50">
            </div>
            <div class="diag-row"><span>Balance</span><span id="fuel-balance">â€”</span></div>
          </div>
          <div class="diagnostics">
            <h3>BIO-DIAGNOSTICS</h3>
            <div class="diag-row"><span>CURRENT BMI</span><span id="val-bmi" class="val-bmi">26.2</span></div>
            <div class="diag-row"><span>BMR</span><span id="val-bmr">1842 kcal/day</span></div>
            <div class="diag-row"><span>METABOLIC BURN</span><span id="val-burn">362 KCAL</span></div>
            <div class="diag-row"><span>FUELING PROTOCOL</span><span id="val-protocol">Baseline Protein</span></div>
            <div class="diag-row success"><span>SYSTEM STATUS</span><span>OPTIMAL</span></div>
          </div>
        </div>
        <!-- Profile tab -->
        <div id="tab-profile" class="tab-pane">
          <h2>PHYSICAL SPECS</h2>
          <p class="hint">Lab uses these for BMI and BMR.</p>
          <label>Weight (kg)</label>
          <input type="number" id="input-weight" value="85" step="0.1" min="20" max="300">
          <label>Height (m)</label>
          <input type="number" id="input-height" value="1.80" step="0.01" min="1" max="2.5">
          <label>Age</label>
          <input type="number" id="input-age" value="30" min="10" max="120">
          <label>Sex</label>
          <div class="sex-toggle">
            <button type="button" id="sex-male" class="sex-btn active">Male</button>
            <button type="button" id="sex-female" class="sex-btn">Female</button>
          </div>
          <label class="checkbox-label">
            <input type="checkbox" id="use-asian-bmi" aria-label="Use WHO Asian BMI cut-offs">
            Use WHO Asian BMI cut-offs (overweight â‰¥23, obese â‰¥27)
          </label>
          <p class="hint hint-small">All calculations follow WHO/ICD-10 and Mifflin-St Jeor (BMR). Units: kg, m, kcal.</p>
          <button id="save-profile" class="btn-primary" aria-label="Save profile and log today's weight">SAVE BASELINE</button>
          <div class="profile-output">
            <p class="label">CURRENT LAB OUTPUT</p>
            <div class="diag-row"><span>BMI</span><span id="profile-bmi" class="profile-bmi-val">26.2</span></div>
            <div class="diag-row"><span>BMI category</span><span id="profile-bmi-cat" class="profile-bmi-cat">â€”</span></div>
            <div class="diag-row"><span>Ideal weight range</span><span id="profile-ideal-range">â€”</span></div>
            <div class="diag-row"><span>BMR</span><span id="profile-bmr">1842 kcal/day</span></div>
            <div class="diag-row"><span>BSA (body surface)</span><span id="profile-bsa">â€”</span></div>
            <div class="diag-row sub"><span>New BMI (Trefethen)</span><span id="profile-new-bmi">â€”</span></div>
          </div>
          <div class="weight-trend">
            <h3>WEIGHT / BMI TREND (7 days)</h3>
            <p id="weight-trend-summary" class="trend-summary">â€”</p>
            <div id="weight-trend-list" class="trend-list"></div>
          </div>
        </div>
        <!-- Report tab -->
        <div id="tab-report" class="tab-pane">
          <div id="report-share-card" class="report-share-card">
            <h2 class="report-heading">WEEKLY DIAGNOSTIC</h2>
            <p class="report-sub">Declassified summary</p>
            <div class="report-card">
              <div class="report-row"><span>Distance this week</span><span id="report-distance">0 km</span></div>
              <div class="report-row"><span>Today's steps</span><span id="report-steps">0</span></div>
              <div class="report-row"><span>Verdict</span><span id="report-verdict" class="verdict">â€”</span></div>
            </div>
          </div>
          <p class="report-hint">Complete expeditions to fill your report. New week starts Monday.</p>
          <div class="report-actions">
            <button id="share-report" class="btn-primary" aria-label="Share weekly report (native share or copy)">SHARE REPORT</button>
            <button id="copy-report" class="btn-secondary btn-copy" aria-label="Copy weekly report to clipboard">COPY TEXT</button>
            <button id="share-report-image" class="btn-secondary" aria-label="Download weekly report as PNG image">DOWNLOAD AS IMAGE</button>
          </div>
        </div>
      </main>
      <nav class="bottom-nav" role="navigation" aria-label="Main sections">
        <button data-tab="map" class="nav-btn" aria-label="Map tab" aria-current="false"><span class="icon" aria-hidden="true">ðŸ—º</span><span>Map</span></button>
        <button data-tab="home" class="nav-btn active" aria-label="Home tab" aria-current="true"><span class="icon" aria-hidden="true">âŒ‚</span><span>Home</span></button>
        <button data-tab="report" class="nav-btn" aria-label="Report tab" aria-current="false"><span class="icon" aria-hidden="true">ðŸ“‹</span><span>Report</span></button>
        <button data-tab="profile" class="nav-btn" aria-label="Profile tab" aria-current="false"><span class="icon" aria-hidden="true">ðŸ‘¤</span><span>Profile</span></button>
      </nav>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="app.js?v=2"></script>
</body>
</html>
